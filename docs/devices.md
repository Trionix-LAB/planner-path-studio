Спецификация оборудования (MVP)

Документ описывает варинанты оборудования для работы водолаза.
# 0. Основное окно оборудования
## 0.1 Схемы оборудования
Для каждого оборудования должна быть своя схема UI компонентов, которая должна реализовываться из файла YAML/JSON. Например
```yaml
Zima2R:
  ipAddres:
    inputForm: "text-line"
    inputMask: "0.0.0.0"
    defaultValue: "127.0.0.1"
  inputPort:
    inputForm: "text-line"
    inputMask: "none"
    defaultValue: "28128"
```

Соответственно на основе этого файла выбираются компоненты для отрисовки (текстовое поле `text-line`), значения по умолчанию и маски ввода, если есть. Каждый файл описан в пункте `Схема конфигурации` для каждого оборудования.

## 0.2 Набор оборудования
Должна быть возможность выбрать те или иные виды оборудования. Сохранить выбор и при начале работы в окне с картами передавать информацию о выбранном оборудовании. (напримерв виде JSON-файла)

# 1. Zima2R
Это система гидроакустической навигации. Имеет две базовые сущности:
- Базовая станция/пеленгационная антенна
- маяк-ответчик
Связь станции с основным приложением происходит с помощью обмена UDP пакетами

## 1.1 Основные настройки
- IP-адрес пеленгационной антенны
- Входной порт команд. Порт для отправки команд из приложения на базовую станцию (если используется)
- Выходной порт данных. Порт для отправки команд от базовой станции в приложение
- Скорость порта ГНСС. Указывает baudrate внешнего ГНСС-компаса (если используется)

## 1.2 Протокол информационного обмена

- **OCON** - Open CONnections. Подключение устройств - открытие соединений. Аналог нажатия кнопки ‘LINK’ в приложении AzimuthSuite. 
Формат команды: `OCON`. Отправлется во входной порт

- **CCON** - Close CONnections. Закрытие всех соединений. Аналог нажатия кнопки ‘LINK’ в приложении AzimuthSuite.
Формат команды: `СCON`. Отправляется во входной порт

- **LHOV** - Location and Heading OVerride.Перегрузка географического положения и азимутального угла. Эта функция может использоваться для задачи вручную географического положения и азимутального угла если пеленгационная антенна статична и не меняет своей ориентации и положения в пространстве.

Формат команды: `LHOV,lat_deg,lon_deg,hdn_deg`. Отправляется во входной порт

| № | Наименование параметра | Описание|
| :---: | :---: | :---: |
| 1 | lat_deg | Географическая широта в градусах в диапазоне от -90 до 90°
| 2 | lon_deg |Географическая долгота в градусах в диапазоне от -180 до 180°
| 3 | hdn_deg |Азимутальный угол в градусах в диапазоне от 0 до 360°

- **AZMLOC** - локальные параметры. Сообщение передается ~1 раз в секунду, когда открыто соединение с пеленгационной антенной или LBL-трансивером.

Формат сообщения: `@AZMLOC,stPressure_mBar,stDepth_m,waterTemp_C,stPitch_deg,stRoll_deg,age,lat_deg,lon_deg,course_deg,speed_mps,age,heading_deg,age,`. Получается из выходного порта

Примечание: в старом потоке может встречаться вариант без завершающей запятой; парсер должен принимать оба варианта.
Примечание: в legacy-формате после `heading_deg,age` могли дополнительно идти `x_m,y_m,z_m,rerr_m,age`.

| № | Наименование параметра | Тип | Единицы измерения | Диапазон значений | Описание | Источник |
| :---: | :--- | :---: | :---: | :---: | :--- | :--- |
| 1 | stPressure_mBar | f32 | мБар | 0 .. 30 | Внешнее давление | Встроенный сенсор |
| 2 | stDepth_m | f32 | м | 0 .. 300 | Глубина погружения устройства | Встроенный сенсор |
| 3 | waterTemp_C | f32 | °С | -4 .. 40 | Температура окружающей среды | Встроенный сенсор |
| 4 | stPitch_deg | f32 | ° | -180 .. 180 | Крен | Встроенный сенсор |
| 5 | stRoll_deg | f32 | ° | -180 .. 180 | Дифферент | Встроенный сенсор |
| 6 | age | f32 | сек | 0 .. | Возраст предыдущих значений | Системные часы |
| 7 | lat_deg | f32 | ° | -90 .. 90 | Географическая широта | Внешний источник AUX1 или значение, заданное командой LHOV |
| 8 | lon_deg | f32 | ° | -180 .. 180 | Географическая долгота | Внешний источник AUX1 или значение, заданное командой LHOV |
| 9 | course_deg | f32 | ° | 0 .. 360 | Курс движения | Внешний источник AUX1 |
| 10 | speed_mps | f32 | м/с | 0 .. | Скорость движения | Внешний источник AUX1 |
| 11 | age | f32 | сек | 0 .. | Возраст предыдущих значений | Системные часы |
| 12 | heading_deg | f32 | ° | 0 .. 360 | Азимутальный угол | Внешний источник AUX1 или AUX2 или значение, заданное командой LHOV |
| 13 | age | f32 | сек | 0 .. | Возраст предыдущего значения | Системные часы |

- **AZMREM** - данные маяка-ответчика
Сообщение передается отдельно для каждого из маяков при обновлении информации - получении ответа маяка или при возникновении таймаута.

Формат сообщения: `@AZMREM,rem_addr,SRange_m,Azimuth_deg,PTime_s,MSR_dB,age,Depth_m,age,SRangeProjection_m,age,ADistance_m,age,AAzimuth_deg,age,Elevation_deg,age,VCC_V,age,WaterTemp_C,age,Lat_deg,Lon_deg,age,RAzimuth_deg,age,Message,age,IsTimeout,`. Получается из выходного порта

Примечание: в legacy-формате могли дополнительно передаваться `X_m,Y_m` или `X_m,Y_m,Z_m` перед `IsTimeout`.

| № | Наименование параметра | Тип | Единицы измерения | Диапазон значений | Описание | Источник |
| :---: | :--- | :---: | :---: | :---: | :--- | :--- |
| 1 | rem_addr | u8 | - | 0 .. 15 | Адрес маяка-ответчика | - |
| 2 | SRange_m | f32 | м | 0 .. | Наклонная дальность между антенной и маяком (допускаются отрицательные значения) | Измерение |
| 3 | Azimuth_deg | f32 | ° | 0 .. 360 | Горизонтальный угол прихода сигнала маяка-ответчика относительно нулевого направления антенны | Измерение |
| 4 | PTime_s | f32 | сек | 0 .. | Время распространения сигнала от маяка до антенны (допускаются отрицательные значения) | Измерение |
| 5 | MSR_dB | f32 | дБ | 14 .. | Качество приема сигнала маяка-ответчика (менее 20 дБ — плохие условия) | Измерение |
| 6 | age | f32 | сек | 0 .. | Возраст предыдущих значений | Системные часы |
| 7 | Depth_m | f32 | м | 0 .. 300/350/500/1000 | Глубина маяка-ответчика | Встроенный сенсор маяка-ответчика |
| 8 | age | f32 | сек | 0 .. | Возраст предыдущего значения | Системные часы |
| 9 | SRangeProjection_m | f32 | м | 0 .. | Проекция наклонной дальности на поверхность | Расчетное значение |
| 10 | age | f32 | сек | 0 .. | Возраст предыдущего значения | Системные часы |
| 11 | ADistance_m | f32 | м | 0 .. | Дальность от точки топопривязки до маяка-ответчика по поверхности воды | Расчетное значение |
| 12 | age | f32 | сек | 0 .. | Возраст предыдущего значения | Системные часы |
| 13 | AAzimuth_deg | f32 | ° | 0 .. 360 | Абсолютный азимут на маяк-ответчик из точки топопривязки | Расчетное значение |
| 14 | age | f32 | сек | 0 .. | Возраст предыдущего значения | Системные часы |
| 15 | Elevation_deg | f32 | ° | 0 .. 360 | Угол места маяка-ответчика | Расчетное значение |
| 16 | age | f32 | сек | 0 .. | Возраст предыдущего значения | Системные часы |
| 17 | VCC_V | f32 | В | 4 .. 16 | Напряжение питания маяка-ответчика | Встроенный сенсор маяка-ответчика |
| 18 | age | f32 | сек | 0 .. | Возраст предыдущего значения | Системные часы |
| 19 | WaterTemp_C | f32 | °С | -4 .. 46 | Температура окружающей среды | Встроенный сенсор маяка-ответчика |
| 20 | age | f32 | сек | 0 .. | Возраст предыдущего значения | Системные часы |
| 21 | Lat_deg | f32 | ° | -90 .. 90 | Географическая широта маяка-ответчика | Расчетное значение |
| 22 | Lon_deg | f32 | ° | -180 .. 180 | Географическая долгота маяка-ответчика | Расчетное значение |
| 23 | age | f32 | сек | 0 .. | Возраст предыдущих значений | Системные часы |
| 24 | RAzimuth_deg | f32 | ° | 0 .. 360 | Абсолютный азимут на станцию от маяка-ответчика | Расчетное значение |
| 25 | age | f32 | сек | 0 .. | Возраст предыдущего значения | Системные часы |
| 26 | Message | string | - | - | Последнее сообщение от маяка-ответчика | - |
| 27 | age | f32 | сек | 0 .. | Возраст предыдущего значения | Системные часы |
| 28 | IsTimeout | bool/string | - | true/false | Признак таймаута — превышения интервала ожидания ответа маяка-ответчика | - |

## 1.3 Схема конфигурации
| № | Название параметра | Тип формы для ввода | Маска ввода | Значение по умолчанию |
| :---: | :--- | :---: | :---: | :---: |
| 1 | IP-адрес | TextLine | 0.0.0.0 | 127.0.0.1 |
| 2 | Входной порт команд | TextLine | - | 28128 |
| 3 | Выходной порт данных | TextLine | - | 28127 |
| 4 | Скорость порта ГНСС | TextLine | - | 115200 |
| 5 | Использование внешнего ГНСС | CheckBox | - | false
| 6 | Использование порта команд | CheckBox | - | false
| 7 | Широта | TextLine | dd.mmmmmm | - |
| 8 | Долгота | TextLine | ddd.mmmmmm | - |
| 9 | Азимут | TextLine | - | - |


# 2. GNSS-UDP
Оборудование для парсинга сообщений от ГНСС компаса по протоколу UDP

## 2.1 Основные настройки
- IP-адрес 
- Выходной порт данных по которому передаются пакеты в приложение.

## 2.2 Протокол информационного обмена
Для взаимодействия используется стандартны протокол навигационного оборудования NMEA 0183. 

## 2.3 Схема конфигурации
| № | Название параметра | Тип формы для ввода | Маска ввода | Значение по умолчанию |
| 1 | IP-адрес | TextLine | 0.0.0.0 | 127.0.0.1 |
| 3 | Выходной порт данных | TextLine | - | 28128 |
