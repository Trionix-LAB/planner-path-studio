# Roadmap MVP (2 спринта)

Цель: сначала закрыть ядро данных и жизненный цикл миссий, затем довести UX/инструменты карты до требований `docs/screens.md`.

## Спринт 1: Core Data + Mission Lifecycle

### 1. Модель миссии и слой persistence
- Реализовать запись/чтение структуры миссии:
  - `mission.json` (`schema_version=1`, `ui`, `tracks`, UTC timestamps с `Z`)
  - `tracks/*.csv` (включая `segment_id`)
  - `routes/routes.geojson` (`kind=route|survey_area|lane`)
  - `markers/markers.geojson` (`kind=marker`)
- Реализовать `mission.lock` create/remove и отказ открытия в режиме записи при обнаружении lock.

### 2. Реальные flows экранов 1/3/4
- `StartScreen`:
  - “Новая миссия” -> реальное создание структуры миссии.
  - “Открыть миссию” -> реальное чтение/валидация.
  - “Восстановить черновик” отображается только при фактическом наличии.
- Проверка совместимости:
  - если `schema_version` миссии выше поддерживаемой, показать понятную ошибку и не делать частичный импорт.
- Черновик:
  - автосохранение в platform storage;
  - восстановление состояния после перезапуска.

### 3. Интеграция `MapWorkspace` с состоянием миссии
- Убрать хардкод объектов/треков/миссии, читать из модели миссии/черновика.
- Включить debounced autosave (1-2 секунды после изменений).
- Сделать индикатор автосохранения реальным (`saving/saved/error`).

### 4. Трек-сессия по MVP правилам
- Реализовать `pause/resume/finish`:
  - `pause`/`finish` закрывают текущий трек (`ended_at`).
  - `resume` после `pause` создает новый активный трек (новый CSV).
- Потеря связи:
  - не закрывает трек;
  - при восстановлении связи увеличивается `segment_id`.

### Definition of Done (Спринт 1)
- Миссию можно создать, закрыть, открыть с теми же данными.
- Черновик переживает перезапуск приложения.
- CSV/GeoJSON/`mission.json` реально пишутся и читаются.
- Ошибки lock/version корректно отображаются пользователю.

## Спринт 2: Map UX + Planning Tools + Export

### 1. Инструменты карты (полный CRUD)
- Route/Zone/Marker:
  - создание реально добавляет объект в состояние;
  - `Esc` отменяет текущее действие и возвращает в select;
  - `Delete` удаляет выделенный объект (с confirm для “опасных” случаев).
- Редактирование:
  - выделение;
  - перетаскивание вершин;
  - добавление/удаление вершины.

### 2. Зона обследования и галсы
- Генерация `lane` из `survey_area` и параметров (`lane_angle_deg`, `lane_width_m`).
- Галсы остаются производными объектами (без прямого редактирования геометрии).
- После изменения зоны:
  - галсы помечаются неактуальными;
  - действие “Перегенерировать” пересоздает lanes.
- Удаление зоны каскадно удаляет связанные lanes.

### 3. Контекстное меню объектов
- Минимум:
  - `Свойства`
  - `Переименовать`
  - `Удалить`
- Для зоны дополнительно:
  - `Перегенерировать галсы`

### 4. Настройки как рабочая система
- Runtime-применение настроек к карте (grid/scale/style/follow/visibility).
- Сохранение:
  - глобальные defaults (приложение);
  - mission overrides (`mission.json`).
- Закрыть обязательные поля MVP:
  - точность координат;
  - шаг/режим сетки;
  - стили track/route/zone/lane/marker;
  - default layer visibility/follow.

### 5. Экспорт MVP
- Реализовать реальный экспорт:
  - треки: GPX/KML;
  - маршруты/галсы: GPX/KML;
  - маркеры: CSV/GPX.
- Поддержать режимы выбора:
  - активный/выбранные/все.
- Сохранять разрывы трека (`segment_id`) как сегменты в экспорте.

### Definition of Done (Спринт 2)
- Полный пользовательский цикл: планирование -> сохранение -> открытие -> редактирование -> экспорт.
- Требования `docs/screens.md` закрыты без критичных пробелов (`MISSING`) в ключевых сценариях.

## Рекомендуемый порядок реализации
1. Сначала `src/platform/*` + `src/features/*` (модель/репозитории), затем UI-слой.
2. После каждого крупного блока выполнять smoke-тест: создать -> перезапустить -> открыть.
3. Для сериализации/совместимости добавить тесты в `src/test` (парсинг/валидация/round-trip).
