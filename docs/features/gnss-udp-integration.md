# feat(integration): GNSS-UDP telemetry service (NMEA 0183)

## Описание
Сервис подключения GNSS-компаса по UDP. Источник отправляет строки NMEA 0183, приложение принимает поток, валидирует сообщения и публикует координаты/курс/скорость в общий telemetry-поток.

## Основные требования интеграции
- Открыть UDP listener на конфигурируемом порту `gnssUdp.dataPort` (по умолчанию `28128`).
- Поддержать конфиг IP интерфейса/хоста `gnssUdp.ipAddress` (по умолчанию `127.0.0.1`).
- Парсить NMEA 0183 предложения (минимум для MVP):
  - `GGA`/`GNS` — координаты и время фикса,
  - `RMC` — координаты, курс (COG), скорость (SOG),
  - `HDT` (опционально) — истинный курс.
- Преобразовывать координаты из формата NMEA (`ddmm.mmmm`) в decimal degrees.
- Отбрасывать невалидные координаты (включая `0,0`) и поврежденные строки.
- Безопасно обрабатывать смешанные и неполные UDP-пакеты (несколько строк в датаграмме, обрезанные хвосты).

## Конфигурация
- Источник хранения: `AppSettings`/`EquipmentSettings`.
- Рекомендуемые поля:
  - `gnssUdp.enabled: boolean` (default `false`)
  - `gnssUdp.ipAddress: string` (default `127.0.0.1`)
  - `gnssUdp.dataPort: number` (default `28128`)
  - `gnssUdp.protocol: 'nmea0183'`

## API / Интерфейс
- События:
  - `gnss:position` `{ lat, lon, course?, speed?, heading?, time?, source: 'GNSS-UDP', entity_type, entity_id, navigation_source_id }`
- Методы:
  - `start()`
  - `stop()`
  - `reloadConfig()`

## Привязка к агентам и базовой станции
- Источник `GNSS-UDP` может быть назначен:
  - конкретному агенту;
  - базовой станции.
- Конфигурация назначения хранится в настройках/миссии (см. `docs/screens.md`, `docs/mission-format.md`).
- Сервис не должен жестко предполагать цель фикса; маршрутизация выполняется по `entity_type/entity_id`, передаваемым в общий telemetry API.

## Тестирование
- Unit:
  - парсер NMEA (валидные/битые строки),
  - преобразование `ddmm.mmmm` -> decimal degrees,
  - обработка split/merge строк по UDP.
- Integration:
  - подача UDP-потока от симулятора,
  - проверка connection state (`ok`/`timeout`/`error`),
  - проверка обновлений координат в UI.

## Критерии приёмки
- [ ] Listener стартует с конфигурируемым портом/интерфейсом.
- [ ] Валидные NMEA сообщения дают фиксы с корректными координатами.
- [ ] Невалидные и поврежденные строки безопасно игнорируются.
- [ ] Сервис публикует позицию и базовую телеметрию в единый интерфейс приложения с маршрутизацией на `agent` или `base_station`.
- [ ] Есть unit/integration тесты и документация запуска.

## Связь
- Спецификация оборудования: `docs/devices.md`
- Экран оборудования: `docs/screens.md`
