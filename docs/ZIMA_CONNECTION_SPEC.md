# Спецификация интеграции с навигационным устройством Zima

Этот документ описывает протокол и логику подключения к навигационному устройству "Zima". Спецификация является технологически-агностичной и предназначена для реализации на любом языке программирования.

## 1. Архитектура подключения
Устройство "Zima" передает навигационные данные по сети.
*   **Тип соединения**: UDP (User Datagram Protocol).
*   **Роль приложения**: Сервер (UDP Listener). Приложение должно открыть UDP-сокет и ожидать входящие пакеты данных.
*   **Сетевые параметры**:
    *   **Порт**: Порт, на который устройство отправляет данные (должен быть конфигурируемым в приложении).
    *   **Адрес**: Приложение слушает на всех интерфейсах (или на конкретном, если требуется), принимая дейтаграммы.

## 2. Формат данных
*   **Протокол**: NMEA 0183 (стандартный текстовый протокол для морского навигационного оборудования).
*   **Кодировка**: ASCII.
*   **Структура пакета**: Данные приходят в виде текстовых строк, начинающихся с символа `$` и заканчивающихся переводом строки (`<CR><LF>`).

## 3. Логика обработки данных (Парсинг)

Приложение должно реализовывать следующий алгоритм обработки входящего потока байт:

1.  **Прием**: Чтение данных из UDP-сокета.
2.  **Буферизация/Разделение**: Сборка входящих байт в строки (разделение по символам переноса строки). Игнорирование неполных или битых строк.
3.  **Фильтрация сообщений**:
    *   Необходимо анализировать идентификатор предложения (Sentence ID) — символы после `$` и до первой запятой.
    *   Целевой тип сообщения: **GGA** (Global Positioning System Fix Data).
    *   Примеры заголовков: `$GPGGA`, `$GNGGA`, `$GLGGA`.

4.  **Извлечение полей**:
    Для сообщений типа **GGA** необходимо извлечь два ключевых значения:
    *   **Широта (Latitude)**: Позиция в NMEA-строке соответствует стандарту GGA (обычно 2-е поле после заголовка, формат `DDMM.MMMM`).
    *   **Долгота (Longitude)**: Позиция в NMEA-строке соответствует стандарту GGA (обычно 4-е поле, формат `DDDMM.MMMM`).
    *   *Примечание*: Также необходимо учитывать поля направления (N/S для широты, E/W для долготы) для корректного определения знака числа.

5.  **Валидация**:
    *   Проверить, что полученные координаты не являются пустыми или нулевыми (`0.0`), так как это часто признак отсутствия GPS-фиксации.

## 4. Алгоритм работы

```pseudo
Функция ЗапускСервиса(порт):
    1. Открыть UDP сокет на указанном порту.
    2. Запустить цикл прослушивания:
        а. Получить пакет данных (datagram).
        б. Преобразовать байты в строку (ASCII).
        в. Если строка соответствует формату NMEA (начинается с '$'):
            i. Определить тип предложения (например, разделить строку по запятым)
            ii. Если тип содержит "GGA":
                - Распарсить поле Широты
                - Распарсить поле Долготы
                - Если координаты валидны (не 0):
                    - Обновить текущее состояние навигации
                    - Опубликовать/Использовать новые координаты
    3. При остановке сервиса закрыть сокет.
```

## 5. Рекомендации по реализации
*   Для парсинга NMEA рекомендуется использовать готовые библиотеки, доступные для целевого языка программирования (например, `pynmea2` для Python, `NMEAParser` для C++, `nmea-0183` для Node.js), вместо написания собственного парсера строк, чтобы корректно обрабатывать контрольные суммы и форматы координат.
*   Обеспечить корректную обработку исключений при сетевых ошибках или некорректном формате данных.
