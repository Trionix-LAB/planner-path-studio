# Task #12: Реализовать запись трека нескольких агентов

**Issue**: [#12](https://github.com/Trionix-LAB/planner-path-studio/issues/12)

**Spec**: R-015

## Описание

Добавить в интерфейс возможность явно выбирать, трек какого агента записывать в данный момент. Пользователь должен видеть список доступных агентов/объектов и включать запись трека для одного (или нескольких) из них — запись должна быть понятной и восстановимой в рамках сеанса/миссии.

## Цели

- Дать пользователю контроль над тем, какие треки сохраняются во время записи (чтобы исключать лишние/шумные данные).
- Обеспечить простую и понятную UX для включения/отключения записи трека для конкретного агента.
- Сохранить выбор в рамках сессии/миссии, чтобы запись могла быть продолжена/восстановлена.

## Пользовательский сценарий

1. В интерфейсе записи/на панели треков появляется контрол «Запись трека» или отдельный переключатель рядом с каждым агентом в списке активных объектов.
2. Пользователь открывает список агентов и включает запись для одного или нескольких агентов (в зависимости от выбранной политики — single/multi). В простом варианте достаточно возможности выбрать один агент для записи.
3. Пока запись включена для агента, его трек сохраняется в текущую сессию; UI показывает индикатор записи рядом с именем агента и на карте (иконка/красный маркер).
4. Пользователь может в любой момент остановить запись для агента; файл/запись трека сохраняется как часть миссии (или предлагается экспортировать).
5. При перезапуске приложения или открытии миссии сохранённые данные о включённой записи (в рамках сессии) восстанавливаются, если это применимо.

## Критерии приёмки

- [ ] В левой панели секция «Агенты» заменяет прежнюю секцию «Треки миссии».
- [ ] Для каждого агента отображается: название, цвет, состояние записи, кнопка записи/паузы, кнопка «Переместиться к».
- [ ] Несколько агентов могут записывать треки параллельно (мультиагентная запись).
- [ ] При клике на агента HUD переключается на его телеметрию, в правой панели показываются треки этого агента.
- [ ] При включении записи для агента UI показывает пульсирующий индикатор записи.
- [ ] Остановить запись можно явно; сохранённый трек виден в правой панели при выборе агента.
- [ ] Треки привязаны к агентам через `agent_id` в `mission.json`.
- [ ] Файлы треков именуются с префиксом агента: `tracks/<agent_uid>-track-NNNN.csv`.
- [ ] Маппинг `active_tracks` (agent_uid → track_id) сохраняется и восстанавливается при перезапуске.
- [ ] Обратная совместимость: миссии без `active_tracks`/`agent_id` открываются корректно.

## Задачи реализации

- Модель данных: добавить `agent_id` в `MissionTrackMeta`, `active_tracks: Record<string, string>` в `MissionDocument`.
- Рефакторинг `trackRecorderReduce` — per-agent start/pause/stop/fix, `trackStatusByAgentId` вместо единого `trackStatus`.
- Левая панель: заменить секцию «Треки миссии» на секцию «Агенты» с индикацией записи и контролами.
- Правая панель: при выбранном агенте показывать его треки (список треков отфильтрованный по `agent_id`).
- MapWorkspace: состояние `selectedAgentId`, routing телеметрии по агентам при записи, HUD переключается на выбранного агента.
- Именование файлов треков с префиксом агента: `<agent_uid>-track-NNNN.csv`.
- Сохранение/загрузка: `active_tracks` в `mission.json`, обратная совместимость с `active_track_id`.
- Accessibility: keyboard навигация по списку агентов, aria-label для состояний.

- Показать список доступных агентов в UI записи/панели треков.
- Добавить переключатель записи рядом с каждым агентом (или раскрывающийся выбор для кнопки «Запись»).
- Визуализировать состояние записи (иконка/цвет/подпись) на панели и на карте.
- Обеспечить явную кнопку остановки/паузы записи для выбранных агентов.
- Сохранение: запоминать, какие агенты записывались в рамках сессии (и при необходимости сохранять метаданные трека в миссии).
- Accessibility: обеспечить keyboard навигацию и понятные состояния для вспомогательных технологий.
>>>>>>> 759fd7125d2ebe31f6df218d200599f3015e2d3a

## Статус

**Статус**: in-progress  
**Исполнитель**: slonikmak  
**Дата создания**: 2026-02-12
