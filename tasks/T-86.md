# T-86: Edit route/zone geometry by coordinates (tables)

**Issue:** #86
**Spec:** New requirement

## Context
Сейчас геометрия планирования создается/редактируется только через карту:
* Route/Zone points живут в `MapObject.geometry` (`src/features/map/model/types.ts`).
* Создание/обновление объектов делается из `src/pages/MapWorkspace.tsx` через `handleObjectCreate` / `handleObjectUpdate`.
* Свойства выбранного объекта редактируются в правой панели через `src/components/map/MapObjectProperties.tsx`.
* Галсы (lane lines) хранятся отдельно от объектов как `laneFeatures` (см. `src/pages/MapWorkspace.tsx`), генерируются из зоны и параметров (`generateLanesFromZoneObject`).
* Для зоны уже есть логика нормализации геометрии в выпуклый полигон (`toConvexZonePolygon`) при create/update.

Проблема: нет табличного ввода/редактирования координат. Пользователь не может:
* создать маршрут/зону из списка координат,
* видеть/править существующие точки как таблицу,
* видеть координаты вершин галсов (read-only) для контроля.

## Goals
* Route: editable table of points (create, update, delete).
* Zone: editable table of zone vertices (create, update, delete).
* Zone: additional read-only table of lane vertices/segments coordinates (NOT editable).
* Two-way sync map <-> table: editing table updates geometry; map edits update the table.
* Validation rules for lat/lon and UX for invalid values.

## Non-goals (MVP)
* Bulk import/export CSV for the tables (can be follow-up).
* Editing lanes coordinates manually (explicitly not allowed).

## Proposed UX placement
* Add new sections in `MapObjectProperties` for:
  - Route: "Точки маршрута" table (editable)
  - Zone: "Вершины зоны" table (editable)
  - Zone: "Вершины галсов" table (read-only)

Keep the existing style of the right panel: compact UI, monospace numbers, inline actions.

## Data & APIs
### Editable table model
* Represent table rows as string inputs (`lat`, `lon`) to allow partial/in-progress edits.
* On commit (blur / Enter / Save button):
  - parse to number, validate ranges
  - if valid: call `onSave(object.id, { geometry: { ... } })`
  - if invalid: show inline error on that row/cell and do not apply geometry

### Read-only lanes table
* Source of truth: `laneFeatures` in `MapWorkspace`.
* Pass lane vertices/segments for the selected zone into `RightPanel` -> `MapObjectProperties`.
  - either as preformatted list of points,
  - or as lane polylines and format inside properties.

## Suggested implementation steps
- [x] Spec update:
  - Добавлено требование `R-051` в `spec/spec.md` (табличное редактирование route/zone + read-only таблица галсов).
- [x] Plumbing (props):
  - Расширены пропсы `RightPanel`/`MapObjectProperties` для передачи `zoneLaneFeatures`.
  - В `MapWorkspace` добавлен расчет `selectedZoneLaneFeatures` для выбранной зоны с детерминированной сортировкой по `lane_index`.
- [x] UI + sync:
  - В `MapObjectProperties` реализованы editable таблицы для route/zone с add/delete/edit.
  - Добавлена read-only таблица «Вершины галсов».
  - Для секций координат (`route`: «Точки маршрута», `zone`: «Вершины зоны» и «Вершины галсов») используется открытие в отдельных всплывающих окнах.
  - Добавлена синхронизация состояния таблиц из `object.geometry` через `useEffect` (map->table).
- [x] Validation:
  - Реализована валидация `lat/lon` и блокировка сохранения при ошибках.
  - Добавлены ограничения минимума точек (`route>=2`, `zone>=3`) при удалении/сохранении.
- [x] Tests:
  - Расширены RTL-тесты `MapObjectProperties`:
    - редактирование координат route -> `onSave`,
    - редактирование координат zone -> `onSave`,
    - невалидные координаты не сохраняются,
    - read-only таблица галсов отображает вершины.
- [x] Verify:
  - `npm run typecheck`
  - `npm run lint`
  - `npm run test`

## Acceptance checklist
- [x] Route table exists and is editable; updates reflect on map.
- [x] Zone vertices table exists and is editable; updates reflect on map.
- [x] Lanes vertices table exists and is read-only; updates when lanes regenerate.
- [x] Invalid input doesn't crash; shows errors; doesn't apply invalid geometry.
- [x] Tests added.
