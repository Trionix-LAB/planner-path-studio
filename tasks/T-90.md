# T-90: Light theme (dark/light) + toggle + persistence

**Issue:** #90
**Spec:** New requirement

## Context
* The app currently uses a single (dark) theme via CSS variables defined in `src/index.css` under `:root`.
* There is no explicit ThemeProvider wiring in `src/main.tsx` (it renders `<App />` directly).
* Settings are surfaced via `SettingsDialog` opened from `src/pages/MapWorkspace.tsx`.
* `next-themes` exists in dependencies, but we can keep the implementation minimal by toggling a `.light`/`.dark` class on `document.documentElement`.

## Goal
* Add a light theme option to complement the existing dark theme.
* Add a theme switcher in Settings and persist user choice across sessions.
* Ensure all main UI surfaces render correctly in both themes.

## Approach (recommended)
* Implement themes using CSS variable sets keyed by root class:
  - Keep `:root` as the current dark tokens (to preserve existing behavior).
  - Add `.light { ... }` with a full light palette using the same token names.
  - Optionally also add `.dark { ... }` mirroring `:root` to make the contract explicit.
* Persist selection:
  - MVP: `localStorage` key (e.g. `pps.theme = 'dark' | 'light'`).
  - Apply class on startup before UI paint (in `src/main.tsx` or a tiny bootstrap module).
* UI:
  - Add a "Theme" control in `SettingsDialog` (radio/select/toggle).
  - On change: update root class + persist.

## Plan
* [x] Spec:
  - Update `spec/spec.md` with a new requirement (R-0xx): supported themes, persistence rules, WCAG AA contrast requirement.
* [x] CSS tokens:
  - Define a light palette in `src/index.css` under `.light { ... }`.
  - Validate contrast for text vs background tokens.
* [x] Theme state + persistence:
  - Add `theme` read/write helpers (single source of truth), store in `localStorage` or `platform.settings`.
  - Apply theme on app start (set class on `document.documentElement`).
* [x] Settings UI:
  - Add a theme selector in `SettingsDialog`.
  - Ensure the UI reflects persisted theme on open.
* [x] Regression sweep:
  - Check `MapWorkspace` panels, dialogs, toasts, tables, inputs.
  - Verify icons/SVG use `currentColor` where applicable.
* [x] Tests:
  - Add a smoke UI test to ensure theme toggle changes root class and persists across remount.
* [x] Verify:
  - `npm run typecheck`
  - `npm run lint`
  - `npm run test`

## Acceptance
* [x] Light palette exists and is applied via theme toggle.
* [x] Theme persists across sessions and applies on startup.
* [x] Dark theme remains unchanged (no regressions).
* [x] Basic tests cover toggle + persistence.

## Execution Log
* Added theme model helper: `src/features/settings/model/theme.ts`.
* Wired startup theme bootstrap in `src/main.tsx` via `initAppTheme()`.
* Added light token palette and theme-aware map surface/grid tokens in `src/index.css`.
* Added theme control in `SettingsDialog` (`Тёмная`/`Светлая`) with apply/reset persistence.
* Updated contract in `spec/spec.md` as `R-052`.
* Added test coverage in `src/test/settingsDialog.test.tsx` for toggle + persistence across remount.
* Verification run:
  - `npm run typecheck` ✅
  - `npm run lint` ✅
  - `npm run test` ✅ (147 tests)
  - `npm run build` ✅
