# T-81: Collapsible map panels (left/right/top)

**Issue:** #81
**Spec:** New requirement

## Context
Экран карты собирается в `src/pages/MapWorkspace.tsx`:
* `TopToolbar` сверху (фиксированная высота `h-12`)
* центральный ряд: `LeftPanel` (`w-56`) + `MapCanvas` (`flex-1`) + `RightPanel` (`w-64`)
* `StatusBar` снизу

Сейчас панели всегда занимают место и уменьшают видимую область карты. Требование: независимое сворачивание/разворачивание панелей в рамках сессии.

## Goal
* Добавить collapse/expand для `LeftPanel`, `RightPanel`, и `TopToolbar` (или его compact mode).
* При collapse карта расширяется корректно (layout не ломается).
* Состояние collapsed хранится в session state (React state; без обязательного персиста между запусками).
* Есть явные контролы восстановления (handles/icons), не перекрывающие важные элементы карты.

## Proposed approach (for handoff)
* Реализовать состояние панелей в `MapWorkspace`:
  - `leftCollapsed`, `rightCollapsed`, `topCollapsed` (+ возможно `topCompact` вместо полного скрытия)
* Визуальные контролы:
  - left/right: узкая вертикальная "ручка" шириной 10-14px с иконкой `ChevronLeft/ChevronRight`, закрепленная у края карты.
  - top: компактная полоска (например `h-8`) с одной кнопкой "Развернуть" + опционально активный tool indicator.
* Layout:
  - LeftPanel/RightPanel при collapse: заменить на handle (или `width: 0` + overlay handle), карта занимает `flex-1`.
  - TopToolbar при collapse: заменить на компактную строку или скрыть полностью, но оставить доступ к восстановлению.
* Анимации:
  - CSS transition по width/height (`transition-all`/`duration-200`), без сложных layout thrash.
* Тестирование:
  - UI test (React Testing Library) на `MapWorkspace` или на отдельный layout-компонент:
    - click collapse → панель скрывается, появляется handle
    - click handle → панель возвращается

## Plan
* [x] Spec: добавить R-0xx (или дополнить существующий раздел UI) про collapsible панели на экране карты.
* [x] Implement: добавить session state и controls в `src/pages/MapWorkspace.tsx`.
* [x] Implement: обновить `LeftPanel`/`RightPanel`/`TopToolbar` интеграцию под collapsed/compact режим.
* [x] UX: убедиться, что controls не перекрывают критичные элементы (zone draft panel, toast, hints).
* [x] Tests: добавить базовые UI tests на collapse/expand.
* [x] Verify: `npm run typecheck`, `npm run lint`, `npm run test`.

## Acceptance
* [x] Каждая панель сворачивается/разворачивается независимо.
* [x] При сворачивании карта расширяется, layout не ломается.
* [x] Состояние collapsed сохраняется в рамках сессии.
* [x] Контролы восстановления видимы и доступны.
* [x] Есть unit/UI тесты на базовые сценарии.

## Follow-up refinement
* [x] Убраны overlay-кнопки сворачивания, контролы переведены в layout rails/tabs.
* [x] Для свернутых левой/правой панелей добавлены явные подписи вкладок («Слои»/«Свойства») + иконки направления.
* [x] Состояние свёрнутости верхней/левой/правой панелей сохраняется между сессиями и восстанавливается при следующем открытии карты.
* [x] Исправлено наложение map layers: dropdown/dialog/toast отображаются поверх карты и не блокируют ввод в поля диалогов.
